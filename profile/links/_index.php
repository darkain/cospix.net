<?php

$user->requireLogin();




////////////////////////////////////////////////////////////////////////////////
//PULL LIST OF ALL SOCIAL TYPES FROM DATABASE
////////////////////////////////////////////////////////////////////////////////
$fields	= $db->listFields('pudl_user_social');

$data	= str_replace(['enum(', ')', '\''], '', $fields['social_type']['type']);

$types	= (new pudlObject($data, PUDL_CSV))
			->flip()->ksort(SORT_FLAG_CASE|SORT_STRING);

$types->each(function(&$value){ $value = NULL; });




////////////////////////////////////////////////////////////////////////////////
//PULL USER'S SOCIAL LINKS, AND MERGE INTO COMPLETE LIST
////////////////////////////////////////////////////////////////////////////////
$links = $db->rowsId('pudl_user_social', $user);
foreach($links as $item) {
	$types[ $item['social_type'] ] = $item['social_url'];
}




////////////////////////////////////////////////////////////////////////////////
//RENDER ALL THE THINGS!!
////////////////////////////////////////////////////////////////////////////////
$af	->load('_index.tpl')
		->field('profile',	$user)
		->block('social',	$types)
	->render();
