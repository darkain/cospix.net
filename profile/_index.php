<?php


////////////////////////////////////////////////////////////////////////////////
//PAGE TITLE
////////////////////////////////////////////////////////////////////////////////
$af->title = 'User Profiles';




////////////////////////////////////////////////////////////////////////////////
//PROCESS SEARCH QUERY
////////////////////////////////////////////////////////////////////////////////
$clause = [];
if ($get->search) {
	$search = preg_split('/[\s,-]+/', $get->search);
	foreach ($search as $item) {
		$clause[] = [
			'us.user_name' => pudl::regexp(pudl::raw('[[:<:]]'), $item)
		];
	}
}




////////////////////////////////////////////////////////////////////////////////
//PULL LIST OF USERS
////////////////////////////////////////////////////////////////////////////////
$users = cpn_user::collect($db, [
	'clause'	=> $clause + ['thumb_hash' => pudl::neq(NULL)],
	'order'		=> pudl::dsc('us.user_id'),
	'limit'		=> 100,
]);




////////////////////////////////////////////////////////////////////////////////
//SET THE CONTAINER DIV ID
////////////////////////////////////////////////////////////////////////////////
$users->id = 'prometheus-filter-result';




////////////////////////////////////////////////////////////////////////////////
//RENDER ALL THE THINGS!
////////////////////////////////////////////////////////////////////////////////
$af->header();

if (!$af->jq()) {
	$af->renderField('_cospix/search.tpl', 'search', $get->search);
}

$users->render($af);

$af->footer();
